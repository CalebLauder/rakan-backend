Rakan IoT Automation Backend

This backend handles device events, automation logic, and communication between IoT devices and AWS services.
It includes AWS Lambda functions, local device simulators, DynamoDB storage, and optional FastAPI endpoints for the frontend.

How to Run the Entire System
1. Clone the Repository
git clone https://github.com/your-username/rakan-backend.git
cd rakan-backend

2. Create & Activate Virtual Environment
python3 -m venv venv
source venv/bin/activate     # Mac

3. Install Dependencies
pip install -r requirements.txt

4. Running the IoT Device Simulators
Motion Sensor
python -m simulator.motion_sensor

Temperature Sensor
python -m simulator.temperature_sensor


Both devices will connect to AWS IoT Core using TLS certificates (stored in /certs).

They publish events to:

rakan/events


and listen for commands on:

rakan/commands/{deviceId}

5. AWS Lambda Configuration

The EventProcessor Lambda must include these environment variables:

Variable	Example Value
EVENT_TABLE	Rakan_EventLogs
STATE_TABLE	Rakan_DeviceState
LAM_FUNCTION_NAME	LAMDecisionEngine
COMMAND_TOPIC_FMT	rakan/commands/{deviceId}

The Lambda should trigger on an AWS IoT Rule:

SELECT * FROM 'rakan/events'

6. Testing the System
View live events and commands:

AWS Console → IoT Core → MQTT Test Client

Subscribe:

rakan/events/#
rakan/commands/#


You should see:

Motion spikes

Temperature drift

Commands generated by Lambda

Fallback actions if LAM is unavailable

7. (Optional) Running the FastAPI Backend

If your team is using the API server:

uvicorn api.main:app --reload


Endpoints include:

GET /devices

GET /logs

POST /device/{id}/command

Used by George's frontend dashboard.

8. System Architecture (Summary)

Simulators publish MQTT events

AWS IoT Core receives the event

IoT Rule triggers EventProcessor Lambda

Lambda logs the event in DynamoDB

Lambda calls LAMDecisionEngine (AI logic)

Lambda publishes command back to IoT Core

Device receives the command and responds

9. Requirements

Python 3.9+

AWS IoT Core configured with certificates

IAM roles with DynamoDB + Lambda Invoke + IoT Publish permissions

DynamoDB tables:

Rakan_EventLogs

Rakan_DeviceState

10. Authors

Caleb – Backend, Lambda, IoT Integration, LAM Engine, GitHub Repo

Henry – MQTT Simulators, Device Logic

Robbie – API + Command Publisher

Tristan – LAMDecisionEngine logic

George – Frontend Dashboard
